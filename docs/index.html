<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>WHEEL</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=RocknRoll+One&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="css/style.min.css">
</head>


<body>
  <!-- start content -->
  <div class="content">
    <div class="wrapper">
    
      <h1>SPIN THE WHEEL</h1>
      <div class="prize-title" id="prize-title">
        Prize 5
      </div>
      <div class="wheel-container">
        
        
        <div class="wheel">
          <div class="wheel-wrap">
            <div class="sec sec-1">
              
            </div>
            <div class="sec sec-2">
             
            </div>
            <div class="sec sec-3">
              
            </div>
            <div class="sec sec-4">
             
            </div>
            <div class="sec sec-5"></div>
          </div>
          <div class="sector sector-1">
            <span>
              Prize 1
            </span>
          </div>
          <div class="sector sector-2">
            <span>Prize 2</span>
          </div>
          <div class="sector sector-3">
            <span>
              Prize 3
            </span>
          </div>
          <div class="sector sector-4">
            <span>Prize 4</span>
          </div>
          <div class="sector sector-5"><span>Prize 5</span></div>
        </div>
      </div>
      <button id="spin" class="button">PRESS HERE</button>
    </div>
  </div>
  <!-- end content -->

  <!-- start modal -->
  <div class="prize-screen" id="prize-modal">
    <div class="modal-content">
      <h2>CONGRATULATIONS!</h2>
      <div class="confetti">🎉</div>
      <p>You got <span id="prize-name"></span></p>
      <button id="done" class="button">DONE</button>
    </div>
  </div>
  <!-- end modal -->
  <audio id="audio" src="audio/voice.mp3" type="audio/mp3"></audio>
  <audio id="winAudio" src="audio/win.mp3" type="audio/mp3"></audio>

</body>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const spinButton = document.getElementById("spin");
  const wheel = document.querySelector(".wheel");
  const prizeTitle = document.getElementById("prize-title");
  const audio = document.getElementById("audio");
  const winAudio = document.getElementById("winAudio");
  let isSpinning = false;
  const totalSectors = 5;
  const winningOption = 3;
  const doneButton = document.getElementById("done"); // Get the DONE button

  doneButton.addEventListener('click', () => {
  const prizeModal = document.getElementById("prize-modal"); // Make sure the ID of your modal window is "prize-modal"
  prizeModal.style.display = "none"; // Hide the modal window
  document.body.style.backgroundColor = ""; // Reset the body background color
  spinButton.disabled = true; // Make the PRESS HERE button disabled
});


  const startSpin = () => {
    if (isSpinning) return;
    isSpinning = true;
    spinButton.disabled = true;

    const totalRotations = 5;
    const finalRotationDegrees = 360 * totalRotations + (360 - ((winningOption - 1) * (360 / totalSectors)) - 72);
    const spinDuration = 12000;
    const startTime = Date.now();

    const animate = () => {
      const elapsedTime = Date.now() - startTime;
      const progress = elapsedTime / spinDuration;
      const easedProgress = easeOutCubic(progress);
      const currentRotation = finalRotationDegrees * easedProgress;

      wheel.style.transform = `rotate(${currentRotation % 360}deg)`;
      updatePrizeTitleDuringSpin(currentRotation);

      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        onFinish();
      }
    };

    const updatePrizeTitleDuringSpin = (rotation) => {
  // Введение небольшой предварительной коррекции к углу поворота, например, 80% от 72 градусов
  const correction = (360 / totalSectors) * 0.8;
  const correctedRotation = (rotation + correction) % 360;
  
  const newSectorIndex = (Math.floor((360 - correctedRotation) / (360 / totalSectors)) + 1) % totalSectors || totalSectors;
  
  if (prizeTitle.textContent !== `Prize ${newSectorIndex}`) {
    audio.currentTime = 0; // Reset the audio to the start
    audio.play(); // Play the click sound
    prizeTitle.textContent = `Prize ${newSectorIndex}`; // Update the text only if it has changed
  }
};


    const onFinish = () => {
      isSpinning = false;
      spinButton.disabled = false;
      document.body.style.backgroundColor = "#D1FFFC";

      setTimeout(() => {
        const prizeModal = document.getElementById("prize-modal");
        const prizeName = document.getElementById("prize-name");
        prizeName.textContent = `Prize ${winningOption}`; // Set the winning prize in the modal text field
        prizeModal.style.display = "block"; // Show the modal window
        winAudio.play(); // Play the winning audio
      }, 2000); // Delay for the modal appearance and audio play
    };

    requestAnimationFrame(animate);
  };

  // Easing function
  function easeOutCubic(x) {
    return 1 - Math.pow(1 - x, 3);
  }

  spinButton.addEventListener('click', startSpin);
});

  </script>
  
  
  
  
</body>

</html>
